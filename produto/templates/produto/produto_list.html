{% load static %} {% load custom_filters %}
<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>lista clientes</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  
    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{% static 'css/forms.css' %}" />
  </head>
  <body>
    {% if '/editar_produto/' in request.path %}    
    <!-- Insira aqui o código ou o modal que deseja mostrar -->
    <script>
        // Caso queira abrir o modal com JavaScript
        document.addEventListener('DOMContentLoaded', function () {
            var editarProdutoModal = new bootstrap.Modal(document.getElementById('createClienteModal'));
            editarProdutoModal.show();
        });
    </script>
  {% endif %}
    {% include 'sidebar.html' with title_page='PRODUTOS' %}
    <main>
      <div class="container-fluid">
        <div style="margin-right: 10px ; width: 50vw; padding: 5px; align-items: center; right: 0; position: absolute;  display: flex; flex-direction: row;">
          <button
          style='margin-top: 0; padding-top: 8px; padding-bottom: 5px; font-size: 0.8em;'
          onClick="window.location.href='{% url 'gerar_relatorio' %}'"
          >GERAR RELATÓRIO</button>
          <form class="d-flex" method="POST" role="search" style='width: 26.5vw; margin-left: 25px;'>
              {% csrf_token %}
            <input
            class="form-control"
            style="border-right: none; border-radius: 5px 0 0 5px; hover: none;"
            type="search"
            name="search"
            placeholder="Search"
            aria-label="Search"
          />
          <button class="btn btn-outline-success" style="margin: auto;" type="submit">Search</button>
        </form>
        <button
          type="button"
          data-bs-toggle="modal"
          data-bs-target="#createClienteModal"
          data-bs-whatever="@mdo"
          style="right: 0; margin-top: 0; padding-top: 5px; padding-bottom: 5px; position: absolute; margin-right: 20px; padding: 8px; font-size: 0.8em;"
        >
          CADASTRAR PRODUTO
        </button>
      </div>
      </div>
      <div
        style="
          display: flex;
          flex-direction: row;
          justify-content: left;
          padding: 20px;
          padding-top: 40px;
          height: 90vh;
          flex-wrap: wrap;
        "
      >
        {% for produto in produtos %}
        <div
          class="product-card"
          onClick="window.location.href='{% url 'editar_produto' produto.id %}'"
        >
          <div class="product-image-container">
            <img
              src="{{ produto.url_imagem }}"
              alt="Produto Genérico"
              class="product-image"
            />
            <div class="product-volume-overlay">
              <p class="product-volume">{{ produto.litragem|format_volume }}</p>
            </div>
          </div>
          <div class="product-info">
            <h2 class="product-name">{{ produto.nome }}</h2>
            <p class="product-price">R$ {{ produto.valor|floatformat:2 }}</p>
          </div>
        </div>
        {% endfor %}
      </div>
      <div
      class="modal fade"
      id="createClienteModal"
      tabindex="-1"
      aria-labelledby="createClienteModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content" style="justify-content: center; align-items: center;">
            <div
          style="
            max-height: 80vh;
            width: 45vw;
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            flex-direction: column;
            margin: 0;
            align-items: center;
          "
        >
          <h2
            style="
              font-size: 1.5em;
              font-weight: bold;
              margin-bottom: 20px;
              margin: auto;
              text-align: center;
            "
          >
            Cadastrar produto
          </h2>
          <form method="POST" 
            action="{% url 'cadastrar_produto' %}"
          class="custom-form style=max-height: 80vh;">
            {% csrf_token %} {{ form }}
            <button type="submit">
              {{titlebutton}}
            </button>
          </form>
          {% if form.errors %}
          <div class="alert alert-danger" role="alert">
            <h4 class="alert-heading">Erro ao cadastrar produto!</h4>
            <p>Verifique os campos obrigatórios e tente novamente.</p>
          </div>
          {% endif %} {% if titlebutton == 'Editar' %}
          <form
            action="{% url 'deletar_produto' produto_id %}"
            method="post"
            class="custom-form"
          >
            {% csrf_token %}
            <button type="submit" style="background-color: rgb(224, 37, 12)">
              Apagar
            </button>
          </form>
          {% endif %}        
        </form>
          </div>
        </div>
      </div>
    </div>  
    </main>
    <script src="{% static 'js\formatacao.js' %}"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".cpf").forEach((el) => {
          el.textContent = formatarCpf(el.textContent);
        });

        document.querySelectorAll(".telefone").forEach((el) => {
          el.textContent = formatarTelefone(el.textContent);
        });
      });
    </script>
  </body>
</html>
